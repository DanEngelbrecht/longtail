name: Windows-Master

on:
  push:
    branches: [ master ]

jobs:
  build:

    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2
    - name: build test
      run: |
        cd ./test 
        ../build.bat
        ../build.bat release
        cd ..
    - name: build cmd
      run: |
        cd ./cmd
        ../build.bat
        ../build.bat release
        cd ..
    - name: build shared_lib
      run: |
        cd ./shared_lib
        ../build.bat
        ../build.bat release
        cd ..
    - name: run tests
      run: |
        cd ./test
        ../build/test_debug.exe
        ../build/test.exe
        cd ..
    - name: build artifacts
      run: mkdir dist-zip
      uses: montudor/action-zip@v0.1.0
        with:
          args: zip -qq -r ./dist-zip/longtail_debug-win-x64.zip ./build/longtail_debug.exe
      uses: montudor/action-zip@v0.1.0
        with:
          args: zip -qq -r ./dist-zip/longtail-win-x64.zip ./build/longtail.exe
      uses: montudor/action-zip@v0.1.0
        with:
          args: zip -qq -r ./dist-zip/longtail_dll_debug-win-x64.zip ./build/longtail_debug.dll
      uses: montudor/action-zip@v0.1.0
        with:
          args: zip -qq -r ./dist-zip/longtail_dll-win-x64.zip ./build/longtail.dll
    - name: upload artifacts
      uses: actions/upload-artifact@master
        with:
          name: dist
          path: dist-zip
